colmap feature_extractor \
    --database_path ./colmap_db.db \
    --image_path ./images/2 \
    --SiftExtraction.use_gpu 0 \
    --SiftExtraction.num_threads 4 





colmap exhaustive_matcher \
    --database_path ./colmap_db.db \
    --SiftMatching.use_gpu 0 \
    --SiftMatching.num_threads 4 \
    --SiftMatching.guided_matching 1 \
    --SiftMatching.max_num_matches 50000


rm -rf ./sparse
mkdir -p ./sparse
colmap mapper \
    --database_path ./colmap_db.db \
    --image_path ./images/2 \
    --output_path ./sparse \
    --Mapper.ba_refine_focal_length 1 \
    --Mapper.ba_refine_principal_point 1 \
    --Mapper.ba_refine_extra_params 1 \
    --Mapper.abs_pose_max_error 1 \
    --Mapper.filter_max_reproj_error 1 \
    --Mapper.filter_min_tri_angle 2


///check
colmap model_analyzer --path ./sparse/0
///check over


mkdir -p ./sparse/0_refined
colmap bundle_adjuster \
    --input_path ./sparse/0 \
    --output_path ./sparse/0_refined \
    --BundleAdjustment.refine_focal_length 1 \
    --BundleAdjustment.refine_principal_point 1 \
    --BundleAdjustment.refine_extra_params 1

colmap model_analyzer --path ./sparse/0_refined    


mkdir -p ./dense
colmap image_undistorter \
    --image_path ./images/2 \
    --input_path ./sparse/0_refined \
    --output_path ./dense \
    --output_type COLMAP


mkdir -p ./dense/sparse_txt
colmap model_converter \
    --input_path ./dense/sparse \
    --output_path ./dense/sparse_txt \
    --output_type TXT




python run_exposure.py \
  --input /Users/karan/development/Projects/ortho/orthomosaic_colmap.png \
  --output /Users/karan/development/Projects/ortho/exposure_corrected.png
